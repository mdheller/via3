settings:
  # Sadly YAML doesn't let you redeclare an anchor...
  - &html_links REWRITE_HTML
  - &external_js REWRITE_JS
  # For fonts to avoid CORS issues you must proxy them. For that to work we must
  # rewrite them in CSS (internal and external)
  - &fonts PROXY_STATIC
  - &external_css REWRITE_CSS
  - &images NONE
  - &forms NONE
  - &default NONE

extensions:
  - &image_ext [png, jpg, jpeg, gif, svg]
  - &font_ext [woff, woff2, ttf, eot]

basic_actions:
  # Don't do anything at all
  - &NONE NONE
  # Convert the URL to be absolute
  - &MAKE_ABSOLUTE MAKE_ABSOLUTE
  # Proxy the content from us, but leave it unchanged
  - &PROXY_STATIC PROXY_STATIC
  # Rewrite the URL so it will go through our HTML rewriting
  - &REWRITE_HTML REWRITE_HTML
  # Rewrite the URL so it will go through our CSS rewriting
  - &REWRITE_CSS REWRITE_CSS
  # Rewrite the URL so it will go through our JS rewriting
  - &REWRITE_JS REWRITE_JS

rules:
  # Random things
  - match: {tag: form}
    action: *forms

  - match: {ext: *font_ext}
    action: *fonts

  # Image rules
  - match: {ext: *image_ext}
    action: *images

  - match: {tag: [img, image], attr: [src, srcset, data-src]}
    action: *images

  - match: {tag: input, attr: src}
    action: *images

  # Links
  - match: {tag: a, attr: href}
    action: *html_links

  - match: {tag: link, rel: stylesheet}
    action: *external_css

  - match: {tag: link, rel: manifest}
    action: *PROXY_STATIC

    comment: From bbc.co.uk, blocked on CORS didn't seem to help
  - match: {tag: link, attr: href, ext: css}
    action: *external_css

  # Javascript rules
  - match: {tag: script, attr: src}
    action: *external_js

  - match: {ext: js}
    action: *external_js

   # External js rules (tag="external-js" as a hack)
  - match: {tag: external-js, ext: js}
    action: *external_js

  - match: {tag: external-js}
    action: *PROXY_STATIC

  # Default
  - match: {}
    action: *default
